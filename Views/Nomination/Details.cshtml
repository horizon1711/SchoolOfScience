@model SchoolOfScience.Models.Nomination

@{
    ViewBag.Title = "Details";
}

<h2>Nomination</h2>

<fieldset>
    <legend>Details</legend>

<ul class="action-list">
    <li>
        @Html.ActionLink("Edit", "Edit", new { id = Model.id })
    </li>
    <li>
        @Html.ActionLink("Cancel", "Delete", new { id = Model.id }, new { id = "nomination-cancel-link" })
    </li>
</ul>

<div class="field-wrapper">
    <div class="display-label">
            @Html.DisplayNameFor(model => model.Program.name)
    </div>
    <div class="display-field">
        @Html.ActionLink(Model.Program.name, "Details", "Program", new { id = Model.program_id }, new { @class = "program-details-link" })
        <div class="program-note">
            <div>
            @if (!String.IsNullOrEmpty(Model.Program.job_position))
            {
                @(Model.Program.job_position)
            }
            </div>
            <div>
            @if (!String.IsNullOrEmpty(Model.Program.host_name))
            {
                if (!String.IsNullOrEmpty(Model.Program.website))
                {
                    <a href="@(Model.Program.website)" target="_blank" title="@(Model.Program.website)">@(Model.Program.host_name)</a>
                }
                else
                {
                    @(Model.Program.host_name)
                }
            }
            </div>
        </div>
    </div>
</div>
<div class="field-wrapper">
    <div class="display-label">
            @Html.DisplayNameFor(model => model.NominationStatus.name)
    </div>
    <div class="display-field">
        @Html.DisplayFor(model => model.NominationStatus.name)
    </div>
</div>
<div class="field-wrapper">
    <div class="display-label">
        Start Date
    </div>
    <div class="display-field">
        @String.Format("{0:yyyy-MM-dd (ddd)}", Model.start_date)
    </div>    
</div>
<div class="field-wrapper">
    <div class="display-label">
        End Date
    </div>
    <div class="display-field">
        @String.Format("{0:yyyy-MM-dd (ddd)}", Model.end_date)
    </div>    
</div>
<div class="field-wrapper">
    <div class="display-label">
        Remarks
    </div>
    <div class="display-field">
        <pre>
            @Model.remarks
        </pre>
    </div>    
</div>

<div class="clear-fix"></div>

</fieldset>

<h2>Shortlists</h2>
@foreach (var list in Model.NominationLists.OrderBy(l => l.nomination_level))
{

<fieldset>
    <legend>Nomination List ID @list.id</legend>
    
<ul class="action-list">
    <li>
        @Html.ActionLink("Edit", "EditList", new { id = list.id })
    </li>
    <li>
        @Html.ActionLink("Notification", "Notify", new { id = list.id }, new { @class = "list-notify-link" })
    </li>
    <li>
        @Html.ActionLink("Cancel", "DeleteList", new { id = list.id }, new { @class = "list-cancel-link" })
    </li>
</ul>
    
<div class="field-wrapper">
    <div class="display-label">
        Nominator
    </div>
    <div class="display-field">
        @list.UserProfile.UserName
    </div>    
</div>
    
<div class="field-wrapper">
    <div class="display-label">
        Level
    </div>
    <div class="display-field">
        @list.nomination_level
    </div>    
</div>
    
<div class="field-wrapper">
    <div class="display-label">
        Display Name
    </div>
    <div class="display-field">
        @list.name
    </div>    
</div>
<div class="field-wrapper">
    <div class="display-label">
        Start Date
    </div>
    <div class="display-field">
        @String.Format("{0:yyyy-MM-dd (ddd)}", list.start_date)
    </div>    
</div>
<div class="field-wrapper">
    <div class="display-label">
        End Date
    </div>
    <div class="display-field">
        @String.Format("{0:yyyy-MM-dd (ddd)}", list.end_date)
    </div>    
</div>
<div class="field-wrapper">
    <div class="display-label">
            Quota
    </div>
    <div class="display-field">
        @if (list.quota == 0)
        {
            @("-")
        }
        else
        {
            @list.quota
        }
    </div>
</div>
<div class="field-wrapper">
    <div class="display-label">
            Remarks
    </div>
    <div class="display-field">
        <pre>
            @list.remarks
        </pre>
        
    </div>
</div>

    @if (list.NominationApplications.Count() > 0)
    {
    <table class="nominated-application-table">
        <thead>
            <tr>
                <th>
                    Application ID
                </th>
                <th>
                    Student Name
                </th>
                <th>
                    Academic Plan
                </th>
                <th>
                    Academic Level
                </th>
                <th>
                    Nominated
                </th>
                <th>
                    Remarks
                </th>
                <th>
                    View Application
                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var nominated in list.NominationApplications)
            {
            <tr>
                <td>
                    @nominated.Application.id
                </td>
                <td>
                    <strong>@Html.DisplayFor(modelItem => nominated.Application.StudentProfile.name) @Html.ActionLink(nominated.Application.StudentProfile.id.ToString(), "Details", "StudentProfile", new { id = nominated.Application.StudentProfile.id }, new { @class = "nominated-student-link" })</strong>
                </td>
                <td>
                    @nominated.Application.StudentProfile.academic_plan_description
                </td>
                <td>
                    @nominated.Application.StudentProfile.academic_level
                </td>
                <td style="white-space:nowrap">
                    @Html.DisplayFor(modelItem => nominated.nominated)
                    @String.Format("{0:yyyy-MM-dd HH:mm}", nominated.nominate_date)
                </td>
                <td>
                    <pre>
                        @nominated.remarks
                    </pre>
                </td>
                <td>
                    <a href="@Url.Action("Details", "Application", new { id = nominated.Application.id })" class = "nominated-action-link action-link" title = "View Application"><img src="@Url.Content("~/Images/Action/view.gif")" /></a>
                </td>
            </tr>
            }
        </tbody>
    </table>
    }
    else
    {
        <text>No shortlisted application.</text>
    }

<div class="field-wrapper">
    <div class="display-label">
            Direct Link for Nominator
    </div>
    <div class="display-field">
        @Html.ActionLink("https://sdb.science.ust.hk/mySCI/Nomination/ApplicationList/" + list.id.ToString(), "ApplicationList", "Nomination", new { id = list.id }, new { target = "_blank" })
    </div>
</div>
</fieldset>
}


<p>@Html.ActionLink("Add Nomintation List", "CreateList", new { nomination_id = Model.id })</p>

<p>
    @Html.ActionLink("Back to List", "Index")
</p>

@section Scripts {
    <script>
        $(function () {
            $(".nominated-application-table").dataTable({
                "sScrollX": "100%",
                "aaSorting": [[5, "desc"]],
                "bPaginate": false,
                "bInfo": false,
                "bFilter": true,
                "oLanguage": {
                    "sSearch": "",
                    "sInfo": "_TOTAL_ entries",
                    "sEmptyTable": "No matching record found"
                }
            });

            $(".program-details-link").click(function (e) {
                e.preventDefault();
                showDialog($(this).prop("href"), "#error-dialog", "#program-details-dialog");
            });

            $(".nominated-student-link").click(function (e) {
                e.preventDefault();
                showDialog($(this).prop("href"), "#error-dialog", "#student-profile-dialog");
            });

            $(".nominated-action-link").click(function (e) {
                e.preventDefault();
                showDialog($(this).prop("href"), "#error-dialog", "#application-dialog");
            });

            $("#nomination-cancel-link").click(function (e) {
                var r = confirm("Are you sure to cancel the whole nomination process? \n\n***Related nomination shortlists and nominated applications will also be cancelled.");
                if (!r) {
                    e.preventDefault();
                }
            });

            $(".list-notify-link").click(function (e) {
                var r = confirm("Are you sure to send notification to the nominator of this nomination shortlist?");
                if (!r) {
                    e.preventDefault();
                }
            });

            $(".list-cancel-link").click(function (e) {
                var r = confirm("Are you sure to cancel this nomination shortlist? \n\n***Related nominated applications will also be cancelled.");
                if (!r) {
                    e.preventDefault();
                }
            });
        });
    </script>
}