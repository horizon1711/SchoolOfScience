@model SchoolOfScience.Models.NominationLevel

@{
}


@if (DateTime.Now > Model.start_date && DateTime.Now < Model.end_date.AddDays(1) && Model.Nomination.NominationStatus.nominated)
{
    <h2>Nomination - Applications</h2>
}
else
{
    <h2>Nomination - Applications (View Only)</h2>
}

<div class="field-wrapper">
    <div class="display-label">
        @Html.DisplayNameFor(model => model.Nomination.Program)
    </div>
    <div class="display-field">
        @Html.ActionLink(Model.Nomination.Program.name, "Details", "Program", new { id = Model.Nomination.Program.id }, new { @class = "program-details-link" })
        <div class="program-note">
            <div>
            @if (!String.IsNullOrEmpty(Model.Nomination.Program.job_position))
            {
                @(Model.Nomination.Program.job_position)
            }
            </div>
            <div>
            @if (!String.IsNullOrEmpty(Model.Nomination.Program.host_name))
            {
                if (!String.IsNullOrEmpty(Model.Nomination.Program.website))
                {
                    <a href="@(Model.Nomination.Program.website)" target="_blank" title="@(Model.Nomination.Program.website)">@(Model.Nomination.Program.host_name)</a>
                }
                else
                {
                    @(Model.Nomination.Program.host_name)
                }
            }
            </div>
        </div>
    </div>
</div>
<div class="field-wrapper">
    <div class="display-label">
        Start Date
    </div>
    <div class="display-field">
        @String.Format("{0:yyyy-MM-dd (ddd)}", Model.start_date)
    </div>
</div>
<div class="field-wrapper">
    <div class="display-label">
        End Date
    </div>
    <div class="display-field">
        @String.Format("{0:yyyy-MM-dd (ddd)}", Model.end_date)
    </div>
</div>
<div class="field-wrapper">
    <div class="display-label">
        Quota
    </div>
    <div class="display-field">
        @if (Model.quota == 0)
        {
            <text> - </text>
        }
        else
        {
            @Model.quota
        }
    </div>
</div>
<div class="field-wrapper clear-left">
    <div class="display-label">
        Remarks
    </div>
    <div class="display-field">
        <pre>
            @Model.remarks
        </pre>
    </div>
</div>
        
<div class="display-label clear-left">
    Nominated Applications:
</div>
    
<div class="display-field">
@if (Model.NominationApplications.Count() > 0)
{
    <table class="nominated-application-table">
        <thead>
            <tr>
                <th>
                    ID
                </th>
                <th>
                    Student Name
                </th>
                <th>
                    Academic Organization
                </th>
                <th>
                    Academic Plan
                </th>
                <th>
                    Academic Level
                </th>
                <th>
                    Remarks
                </th>
                <th>
                        
                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var nominated in Model.NominationApplications)
            {
            <tr>
                <td>
                    @nominated.Application.id
                </td>
                <td>
                    <strong>@Html.DisplayFor(modelItem => nominated.Application.StudentProfile.name) @Html.ActionLink(nominated.Application.StudentProfile.id.ToString(), "Details", "StudentProfile", new { id = nominated.Application.StudentProfile.id }, new { @class = "nominated-student-link" })</strong>
                </td>
                <td>
                    @nominated.Application.StudentProfile.academic_organization
                </td>
                <td>
                    @nominated.Application.StudentProfile.academic_plan_description
                </td>
                <td>
                    @nominated.Application.StudentProfile.academic_level
                </td>
                <td>
                    <pre>
                        @nominated.remarks
                    </pre>
                </td>
                <td>
                    <a href="@Url.Action("Details", "Application", new { id = nominated.Application.id })" class = "nominated-action-link action-link" title = "View Application"><img src="@Url.Content("~/Images/Action/view.gif")" /></a>
                    @if (Model.NominationApplications.Any(a => a.Application.id == nominated.Application.id) && DateTime.Now > Model.start_date && DateTime.Now < Model.end_date.AddDays(1) && Model.Nomination.NominationStatus.nominated)
                    {
                        <a href="@Url.Action("CancelNominateApplication", "Nomination", new { id = nominated.id })" class = "nominated-cancel-link action-link" title = "Cancel Nomination"><img src="@Url.Content("~/Images/Action/delete.gif")" /></a>
                    }
                </td>
            </tr>
            }
        </tbody>
    </table>
}
else
{
    <text>None</text>
}
</div>
        
<div class="display-label clear-left">
    Shortlisted Applications:
</div>
    
<div class="display-field">
@if (Model.Nomination.NominationLevels.FirstOrDefault(l => l.nomination_level == Model.nomination_level - 1) != null
    && Model.Nomination.NominationLevels.FirstOrDefault(l => l.nomination_level == Model.nomination_level - 1).NominationApplications.Count() > 0)
{
    <table class="nominated-application-table">
        <thead>
            <tr>
                <th>
                    ID
                </th>
                <th>
                    Student Name
                </th>
                <th>
                    Academic Organization
                </th>
                <th>
                    Academic Plan
                </th>
                <th>
                    Academic Level
                </th>
                <th>
                    Remarks
                </th>
                <th>
                        
                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var nominated in Model.Nomination.NominationLevels.FirstOrDefault(l => l.nomination_level == Model.nomination_level - 1).NominationApplications)
            {
            <tr>
                <td>
                    @nominated.Application.id
                </td>
                <td>
                    <strong>@Html.DisplayFor(modelItem => nominated.Application.StudentProfile.name) @Html.ActionLink(nominated.Application.StudentProfile.id.ToString(), "Details", "StudentProfile", new { id = nominated.Application.StudentProfile.id }, new { @class = "nominated-student-link" })</strong>
                </td>
                <td>
                    @nominated.Application.StudentProfile.academic_organization
                </td>
                <td>
                    @nominated.Application.StudentProfile.academic_plan_description
                </td>
                <td>
                    @nominated.Application.StudentProfile.academic_level
                </td>
                <td>
                    <pre>
                        @nominated.remarks
                    </pre>
                </td>
                <td>
                    @if (Model.NominationApplications.Any(a => a.Application.id == nominated.Application.id))
                    {
                        <text>Nominated</text>
                    }
                    else
                    {
                        if (DateTime.Now > Model.start_date && DateTime.Now < Model.end_date.AddDays(1) && Model.Nomination.NominationStatus.nominated)
                        {
                            <a href="@Url.Action("Details", "Application", new { id = nominated.Application.id, levelid = Model.id })" class = "nominated-action-link action-link" title = "View/Nominate Application"><img src="@Url.Content("~/Images/Action/view.gif")" /></a>
                        }
                        else
                        {
                            <a href="@Url.Action("Details", "Application", new { id = nominated.Application.id })" class = "nominated-action-link action-link" title = "View Application"><img src="@Url.Content("~/Images/Action/view.gif")" /></a>
                        }
                    }
                </td>
            </tr>
            }
        </tbody>
    </table>
}
else
{
    <text>None</text>
}
</div>
    
<div class="clear-fix"></div>

<div>
    @Html.ActionLink("Back to List", "MyNomination")
</div>

@section Scripts {
    <script>
        $(function () {
            $(".nominated-application-table").dataTable({
                "sScrollX": "100%",
                "aaSorting": [[0, "asc"]],
                "bPaginate": false,
                "bInfo": false,
                "bFilter": true,
                "oLanguage": {
                    "sSearch": "",
                    "sInfo": "_TOTAL_ entries",
                    "sEmptyTable": "No matching record found"
                }
            });

            $(".program-details-link").click(function (e) {
                e.preventDefault();
                showDialog($(this).prop("href"), "#error-dialog", "#program-details-dialog");
            });

            $(".nominated-student-link").click(function (e) {
                e.preventDefault();
                showDialog($(this).prop("href"), "#error-dialog", "#student-profile-dialog");
            });

            $(".nominated-action-link").click(function (e) {
                e.preventDefault();
                showDialog($(this).prop("href"), "#error-dialog", "#application-dialog");
            });

            $(".nominated-cancel-link").click(function (e) {
                var r = confirm("Are you sure to cancel this nomination? \n\n***Related nomination comment will be removed.");
                if (!r) {
                    e.preventDefault();
                }
            });
        });
    </script>
}
