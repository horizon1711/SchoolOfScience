@model IEnumerable<SchoolOfScience.Models.ApplicationComment>

@{
    Layout = null;
    var rand = new Random();
    var random_int = rand.Next();
    SchoolOfScience.Models.Application application = ViewBag.application;
}

<h2>Program Comments</h2>

    <div class="display-label">
        Program
    </div>
    <div class="display-field">
        @Html.ActionLink(application.Program.name, "Details", "Program", new { id = application.program_id }, new { @class = "comment-program-details-link" })
        <div class="program-note">
            <div>
            @if (!String.IsNullOrEmpty(application.Program.job_position))
            {
                @(application.Program.job_position)
            }
            </div>
            <div>
            @if (!String.IsNullOrEmpty(application.Program.host_name))
            {
                if (!String.IsNullOrEmpty(application.Program.website))
                {
                    <a href="@(application.Program.website)" target="_blank" title="@(application.Program.website)">@(application.Program.host_name)</a>
                }
                else
                {
                    @(application.Program.host_name)
                }
            }
            </div>
        </div>
    </div>


    <div class="display-label">
        Applicant
    </div>
    <div class="display-field">
        <strong>@Html.DisplayFor(modelItem => application.StudentProfile.name) @Html.ActionLink(application.StudentProfile.id.ToString(), "Details", "StudentProfile", new { id = application.StudentProfile.id }, new { @class = "comment-student-link" })</strong>
    </div>

<table class="acomment-table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.id)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.comment)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.modified)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
    @foreach (var item in Model) {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.id)
            </td>
            <td>
                <pre>
                    @Html.DisplayFor(modelItem => item.comment)
                </pre>
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.modified) <br />
                [@Html.DisplayFor(modelItem => item.modified_by)]
            </td>
            <td>
                <a href="@Url.Action("Edit", "ApplicationComment", new { id = item.id })" class="edit-comment-btn"><img src="@Url.Content("~/Images/Action/edit.gif")" class="edit-btn" title="Edit this comment"/></a>
                <a href="@Url.Action("Delete", "ApplicationComment", new { id = item.id })" class="delete-comment-btn"><img src="@Url.Content("~/Images/Action/delete.gif")" class="delete-btn" title="Remove this comment"/></a>
            </td>
        </tr>
    }
    </tbody>
</table>
<div class="clear-fix"></div>

<script>
    $(function () {

        $(".acomment-table").dataTable({
            "sScrollX": "100%",
            "bPaginate": false
        });

        $(".edit-comment-btn").click(function (e) {
            e.preventDefault();
            showDialog($(this).prop("href"), "#error-dialog", "#add-edit-dialog");
        });

        $(".delete-comment-btn").click(function (e) {
            e.preventDefault();
            $.ajax({
                cache: false,
                url: $(this).prop("href"),
                error: function (jqXHR, status, error) {
                    $("#error-dialog").html(error).dialog({
                        width: 350,
                        height: 100,
                        overflow: "auto",
                        modal: true,
                        resizable: false,
                        draggable: false,
                        open: function () {
                            $(this).scrollTop(0);
                            $('.ui-widget-overlay').hide().fadeIn();
                        },
                        show: {
                            effect: 'fade',
                            duration: 200
                        },
                        hide: {
                            effect: 'fade',
                            duration: 100
                        }
                    });
                },
                success: function (result) {
                    $("#application-comment-dialog").html(result);
                }
            });
            return false;
        });

        $(".comment-program-details-link").click(function (e) {
            e.preventDefault();
            showDialog($(this).prop("href"), "#error-dialog", "#program-details-dialog");
        });

        $(".comment-student-link").click(function (e) {
            e.preventDefault();
            showDialog($(this).prop("href"), "#error-dialog", "#student-profile-dialog");
        });
    });
</script>